# ガイドライン変更提案: 検証コマンドの実行タイミング最適化

作成日: 2025-11-07
提案者: 開発支援AI

## 背景
現行ガイドラインでは、コード出力・修正のたびに以下を毎回実行しています。

- `npx tsc --noEmit`
- `npx prettier --check "src/**/*.{ts,tsx,css}"`
- `npm run build`

この運用は安全ですが、**毎回の実行は時間・リソースの非効率**になるケースがあり、開発体験の低下を招くことがあります。

## 目標
- 品質と安全性を維持しつつ、無駄な検証の繰り返しを削減する。
- 実質的な変更や影響範囲の大きい修正にのみ検証コマンドを実行する。

## 提案内容（改訂案）

### 実行基準の定義
以下の条件に該当する場合にのみ、検証コマンドを実行します。

1. **大規模修正**
   - 3ファイル以上の同時変更、または500行以上の差分。
2. **ビルド/型安全へ影響する修正**
   - TypeScript型定義・関数シグネチャ・ビルド設定（`vite.config.ts`/`tsconfig.json`）の変更。
   - 外部依存の導入/更新（`package.json`）。
3. **ランタイムに影響する修正**
   - ルーティング・API呼び出し・Service Worker・認証・状態管理の変更。
4. **CI失敗やエラー報告への対応**
   - 直近でビルド失敗、型エラー、ランタイム例外が報告されている領域の変更。

### 実行するコマンド
- 型検査: `npx tsc --noEmit`（2に該当）
- フォーマット検査: `npx prettier --check "src/**/*.{ts,tsx,css}"`（1,2,3に該当）
- プロダクションビルド: `npm run build`（1,2,3に該当）

### 免除例
- 文章のみの変更（`docs/`配下、`README`類）。
- スタイル微調整（1ファイル内で軽微なCSS変更）。
- コメントや非ロジックなリファクタ（命名修正のみ等）。

## 効果
- 検証コスト削減（時間・CPU・電力消費）。
- 重要変更時のみ確実に検証し、品質は担保。

## 補足
- 本提案は**運用ルールの改訂**であり、適用にはプロジェクトオーナーの承認が必要です。
- 承認後は、コミットメッセージ/PRテンプレートに「検証実施有無（Yes/No）と根拠」を記載し、属人化を防ぎます。

## 承認可否
- 承認: 変更を適用し、次回以降の作業から新ルールに従います。
- 差戻し: 追加条件やしきい値の調整を協議の上、再提案します。