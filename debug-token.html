<!doctype html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>å‹¤æ€ ã‚¢ãƒ—ãƒª - ãƒˆãƒ¼ã‚¯ãƒ³ãƒ‡ãƒãƒƒã‚°ãƒ„ãƒ¼ãƒ«</title>
    <style>
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
        background-color: #f5f5f5;
      }
      .container {
        background: white;
        padding: 30px;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }
      h1 {
        color: #333;
        text-align: center;
        margin-bottom: 30px;
      }
      .section {
        margin-bottom: 30px;
        padding: 20px;
        border: 1px solid #ddd;
        border-radius: 8px;
        background-color: #fafafa;
      }
      .section h2 {
        color: #555;
        margin-top: 0;
      }
      button {
        background-color: #007bff;
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 16px;
        margin: 5px;
      }
      button:hover {
        background-color: #0056b3;
      }
      button.danger {
        background-color: #dc3545;
      }
      button.danger:hover {
        background-color: #c82333;
      }
      button.success {
        background-color: #28a745;
      }
      button.success:hover {
        background-color: #218838;
      }
      .info {
        background-color: #e7f3ff;
        border: 1px solid #b3d9ff;
        padding: 15px;
        border-radius: 6px;
        margin: 10px 0;
      }
      .warning {
        background-color: #fff3cd;
        border: 1px solid #ffeaa7;
        padding: 15px;
        border-radius: 6px;
        margin: 10px 0;
      }
      .error {
        background-color: #f8d7da;
        border: 1px solid #f5c6cb;
        padding: 15px;
        border-radius: 6px;
        margin: 10px 0;
      }
      .success {
        background-color: #d4edda;
        border: 1px solid #c3e6cb;
        padding: 15px;
        border-radius: 6px;
        margin: 10px 0;
      }
      pre {
        background-color: #f8f9fa;
        border: 1px solid #e9ecef;
        padding: 15px;
        border-radius: 6px;
        overflow-x: auto;
        white-space: pre-wrap;
        word-wrap: break-word;
      }
      .status {
        font-weight: bold;
        padding: 10px;
        border-radius: 6px;
        margin: 10px 0;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>ğŸ”§ å‹¤æ€ ã‚¢ãƒ—ãƒª - ãƒˆãƒ¼ã‚¯ãƒ³ãƒ‡ãƒãƒƒã‚°ãƒ„ãƒ¼ãƒ«</h1>

      <div class="info">
        <strong>ğŸ“‹ ä½¿ç”¨æ–¹æ³•:</strong><br />
        1. ã¾ãšã€Œç¾åœ¨ã®çŠ¶æ…‹ã‚’ç¢ºèªã€ãƒœã‚¿ãƒ³ã§ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®çŠ¶æ…‹ã‚’ç¢ºèª<br />
        2.
        ã€Œãƒˆãƒ¼ã‚¯ãƒ³ãŒç„¡åŠ¹ã§ã™ã€ã‚¨ãƒ©ãƒ¼ãŒå‡ºã¦ã„ã‚‹å ´åˆã¯ã€Œãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚’ã‚¯ãƒªã‚¢ã€<br />
        3. ã‚¯ãƒªã‚¢å¾Œã€å‹¤æ€ ã‚¢ãƒ—ãƒªã«æˆ»ã£ã¦å†ãƒ­ã‚°ã‚¤ãƒ³
      </div>

      <div class="section">
        <h2>ğŸ” ç¾åœ¨ã®çŠ¶æ…‹ç¢ºèª</h2>
        <button onclick="checkCurrentStatus()">ç¾åœ¨ã®çŠ¶æ…‹ã‚’ç¢ºèª</button>
        <div id="statusResult"></div>
      </div>

      <div class="section">
        <h2>ğŸ§¹ ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ç®¡ç†</h2>
        <button class="danger" onclick="clearKintaiData()">
          å‹¤æ€ ã‚¢ãƒ—ãƒªã®ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢
        </button>
        <button class="danger" onclick="clearAllLocalStorage()">
          å…¨ã¦ã®ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚’ã‚¯ãƒªã‚¢
        </button>
        <div id="clearResult"></div>
      </div>

      <div class="section">
        <h2>ğŸ”— ã‚¢ãƒ—ãƒªã¸ã®ãƒªãƒ³ã‚¯</h2>
        <button class="success" onclick="openKintaiApp()">
          å‹¤æ€ ã‚¢ãƒ—ãƒªã‚’é–‹ã
        </button>
        <div class="info">
          <strong>æ³¨æ„:</strong>
          ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚’ã‚¯ãƒªã‚¢ã—ãŸå¾Œã¯ã€å‹¤æ€ ã‚¢ãƒ—ãƒªã§å†ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦ã§ã™ã€‚
        </div>
      </div>

      <div class="section">
        <h2>ğŸ“Š è©³ç´°æƒ…å ±</h2>
        <button onclick="showDetailedInfo()">è©³ç´°æƒ…å ±ã‚’è¡¨ç¤º</button>
        <div id="detailedInfo"></div>
      </div>
    </div>

    <script>
      function checkCurrentStatus() {
        const statusDiv = document.getElementById("statusResult");

        const token = localStorage.getItem("kintai_token");
        const userId = localStorage.getItem("kintai_user_id");
        const userName = localStorage.getItem("kintai_user_name");

        let html = '<div class="status">';

        if (token && userId && userName) {
          html += '<div class="success">âœ… èªè¨¼æƒ…å ±ãŒå­˜åœ¨ã—ã¾ã™</div>';
          html += `<div class="info">`;
          html += `<strong>ãƒ¦ãƒ¼ã‚¶ãƒ¼ID:</strong> ${userId}<br>`;
          html += `<strong>ãƒ¦ãƒ¼ã‚¶ãƒ¼å:</strong> ${userName}<br>`;
          html += `<strong>ãƒˆãƒ¼ã‚¯ãƒ³:</strong> ${token.substring(0, 20)}...<br>`;
          html += `<strong>ãƒˆãƒ¼ã‚¯ãƒ³é•·:</strong> ${token.length}æ–‡å­—`;
          html += `</div>`;
        } else {
          html +=
            '<div class="warning">âš ï¸ èªè¨¼æƒ…å ±ãŒä¸å®Œå…¨ã¾ãŸã¯å­˜åœ¨ã—ã¾ã›ã‚“</div>';
          html += `<div class="info">`;
          html += `<strong>ãƒˆãƒ¼ã‚¯ãƒ³:</strong> ${token ? "å­˜åœ¨" : "âŒ ãªã—"}<br>`;
          html += `<strong>ãƒ¦ãƒ¼ã‚¶ãƒ¼ID:</strong> ${userId ? "å­˜åœ¨" : "âŒ ãªã—"}<br>`;
          html += `<strong>ãƒ¦ãƒ¼ã‚¶ãƒ¼å:</strong> ${userName ? "å­˜åœ¨" : "âŒ ãªã—"}`;
          html += `</div>`;
        }

        // ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®ç¢ºèª
        const monthlyData = sessionStorage.getItem("kintai_monthly_data");
        const monthlyTimestamp = sessionStorage.getItem(
          "kintai_monthly_data_timestamp"
        );

        html += `<div class="info">`;
        html += `<strong>æœˆæ¬¡ãƒ‡ãƒ¼ã‚¿ã‚­ãƒ£ãƒƒã‚·ãƒ¥:</strong> ${monthlyData ? "å­˜åœ¨" : "ãªã—"}<br>`;
        html += `<strong>ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—:</strong> ${monthlyTimestamp ? new Date(parseInt(monthlyTimestamp)).toLocaleString() : "ãªã—"}`;
        html += `</div>`;

        html += "</div>";
        statusDiv.innerHTML = html;
      }

      function clearKintaiData() {
        const resultDiv = document.getElementById("clearResult");

        try {
          // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰å‹¤æ€ ã‚¢ãƒ—ãƒªé–¢é€£ã®ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤
          localStorage.removeItem("kintai_token");
          localStorage.removeItem("kintai_user_id");
          localStorage.removeItem("kintai_user_name");
          localStorage.removeItem("kintai_current_customer");
          localStorage.removeItem("kintai_customer_spreadsheet_id");
          localStorage.removeItem("kintai_server_version");

          // ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’å‰Šé™¤
          sessionStorage.removeItem("kintai_monthly_data");
          sessionStorage.removeItem("kintai_monthly_data_timestamp");

          resultDiv.innerHTML =
            '<div class="success">âœ… å‹¤æ€ ã‚¢ãƒ—ãƒªã®ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸï¼<br>å‹¤æ€ ã‚¢ãƒ—ãƒªã«æˆ»ã£ã¦å†ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„ã€‚</div>';
        } catch (error) {
          resultDiv.innerHTML = `<div class="error">âŒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ${error.message}</div>`;
        }
      }

      function clearAllLocalStorage() {
        const resultDiv = document.getElementById("clearResult");

        if (
          confirm(
            "å…¨ã¦ã®ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ\nï¼ˆä»–ã®Webã‚µã‚¤ãƒˆã®ãƒ‡ãƒ¼ã‚¿ã‚‚å«ã¾ã‚Œã¾ã™ï¼‰"
          )
        ) {
          try {
            localStorage.clear();
            sessionStorage.clear();
            resultDiv.innerHTML =
              '<div class="success">âœ… å…¨ã¦ã®ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸï¼</div>';
          } catch (error) {
            resultDiv.innerHTML = `<div class="error">âŒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ${error.message}</div>`;
          }
        }
      }

      function openKintaiApp() {
        // ç¾åœ¨ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã®ãƒ«ãƒ¼ãƒˆã«ç§»å‹•ï¼ˆå‹¤æ€ ã‚¢ãƒ—ãƒªã®index.htmlï¼‰
        window.location.href = "/";
      }

      function showDetailedInfo() {
        const detailDiv = document.getElementById("detailedInfo");

        let html = "<h3>ğŸ“‹ ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸å…¨ä½“</h3>";
        html += "<pre>";

        const localStorageData = {};
        for (let i = 0; i < localStorage.length; i++) {
          const key = localStorage.key(i);
          const value = localStorage.getItem(key);
          localStorageData[key] = value;
        }

        html += JSON.stringify(localStorageData, null, 2);
        html += "</pre>";

        html += "<h3>ğŸ“‹ ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸å…¨ä½“</h3>";
        html += "<pre>";

        const sessionStorageData = {};
        for (let i = 0; i < sessionStorage.length; i++) {
          const key = sessionStorage.key(i);
          const value = sessionStorage.getItem(key);
          sessionStorageData[key] = value;
        }

        html += JSON.stringify(sessionStorageData, null, 2);
        html += "</pre>";

        html += "<h3>ğŸŒ ãƒ–ãƒ©ã‚¦ã‚¶æƒ…å ±</h3>";
        html += "<pre>";
        html += `User Agent: ${navigator.userAgent}\n`;
        html += `URL: ${window.location.href}\n`;
        html += `Domain: ${window.location.hostname}\n`;
        html += `Protocol: ${window.location.protocol}\n`;
        html += `ç¾åœ¨æ™‚åˆ»: ${new Date().toLocaleString()}`;
        html += "</pre>";

        detailDiv.innerHTML = html;
      }

      // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«è‡ªå‹•ã§çŠ¶æ…‹ç¢ºèª
      window.addEventListener("load", function () {
        checkCurrentStatus();
      });
    </script>
  </body>
</html>
